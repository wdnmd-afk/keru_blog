# 文件上传进度条定时更新优化

## 任务描述

用户反馈文件上传进度条始终显示为0%且未更新，要求调整为每1秒自动更新一次进度条状态，以确保用户能够实时看到上传进度。

## 问题分析

### 当前进度更新机制

1. **依赖网络事件**: 当前进度更新完全依赖于 `FileApi.uploadFile` 的 `onUploadProgress` 回调
2. **被动触发**: 只有在网络传输过程中浏览器触发进度事件时才会更新UI
3. **不稳定性**: 网络环境不稳定或浏览器进度事件触发频率低时，可能导致进度条长时间不更新

### 核心问题

- `uploadChunk` 函数中的 `onUploadProgress` 回调依赖浏览器的网络进度事件
- 如果网络传输缓慢或事件触发间隔较长，用户会看到进度条"卡住"
- 缺乏主动的定时更新机制来保证UI的实时性

## 解决方案

### 方案一：添加定时器定期更新进度（推荐）

**优点**:
- 确保进度条每秒都会更新
- 用户体验更好，不会出现"卡住"的感觉
- 实现简单，风险较低

**实现思路**:
1. 在 `useUpload` Hook 中添加定时器状态管理
2. 在开始上传时启动定时器，每1秒调用一次 `updateProgress`
3. 在上传完成或暂停时清除定时器
4. 确保定时器不会与网络事件冲突

### 方案二：优化进度计算逻辑

**优点**:
- 提高进度计算的准确性
- 减少对网络事件的依赖

**实现思路**:
1. 记录每个分片的开始上传时间
2. 基于时间和已上传字节数估算当前进度
3. 结合网络事件和时间估算提供更平滑的进度更新

## 实施计划

### 第一阶段：添加定时器机制

1. **修改 useUpload Hook**:
   - 添加定时器状态管理
   - 在上传开始时启动定时器
   - 在上传结束时清除定时器

2. **优化 updateProgress 函数**:
   - 确保函数可以安全地被定时器调用
   - 添加防抖机制避免过度更新

3. **测试验证**:
   - 验证定时器正常工作
   - 确保进度更新不会影响上传性能
   - 测试各种网络环境下的表现

### 第二阶段：性能优化

1. **添加进度缓存机制**
2. **优化定时器频率**
3. **添加上传速度计算**

## 相关文件

- `frontEnd/src/hooks/useUpload.ts` - 主要修改文件
- `frontEnd/src/views/Files/Upload.tsx` - 进度显示组件
- `frontEnd/src/api/fileApi.ts` - 上传API接口

## 风险评估

### 低风险
- 添加定时器不会影响现有上传逻辑
- 定时器只是额外触发进度更新，不会改变数据计算

### 需要注意
- 确保定时器在组件卸载时正确清理
- 避免定时器过于频繁导致性能问题
- 处理多文件同时上传时的定时器管理

## 预期效果

1. **用户体验提升**: 进度条每秒更新，不会出现"卡住"现象
2. **实时反馈**: 即使在网络缓慢的情况下也能看到进度变化
3. **稳定性增强**: 不完全依赖网络事件，提供更可靠的进度显示
4. **向后兼容**: 保持现有功能不变，只是增强进度更新机制

---

**创建时间**: 2025-01-16  
**创建者**: AI Assistant  
**协议**: RIPER-5 + 多维思考 + 智能体执行协议
{
  "basicConcept": {
    "title": "äº‹ä»¶å¾ªç¯åŸºæœ¬æ¦‚å¿µ",
    "language": "javascript",
    "code": "// Node.js äº‹ä»¶å¾ªç¯ç¤ºä¾‹\nconsole.log('å¼€å§‹')\n\n// åŒæ­¥ä»£ç \nconsole.log('åŒæ­¥ä»£ç  1')\n\n// å¼‚æ­¥ä»£ç  - setTimeout\nsetTimeout(() => {\n  console.log('setTimeout å›è°ƒ')\n}, 0)\n\n// å¼‚æ­¥ä»£ç  - setImmediate\nsetImmediate(() => {\n  console.log('setImmediate å›è°ƒ')\n})\n\n// å¼‚æ­¥ä»£ç  - process.nextTick\nprocess.nextTick(() => {\n  console.log('process.nextTick å›è°ƒ')\n})\n\n// åŒæ­¥ä»£ç \nconsole.log('åŒæ­¥ä»£ç  2')\n\nconsole.log('ç»“æŸ')\n\n// è¾“å‡ºé¡ºåº:\n// å¼€å§‹\n// åŒæ­¥ä»£ç  1\n// åŒæ­¥ä»£ç  2\n// ç»“æŸ\n// process.nextTick å›è°ƒ\n// setTimeout å›è°ƒ\n// setImmediate å›è°ƒ"
  },
  "eventLoopPhases": {
    "title": "äº‹ä»¶å¾ªç¯é˜¶æ®µ",
    "language": "javascript",
    "code": "// äº‹ä»¶å¾ªç¯çš„å…­ä¸ªé˜¶æ®µç¤ºä¾‹\nconst fs = require('fs')\n\nconsole.log('=== äº‹ä»¶å¾ªç¯é˜¶æ®µæ¼”ç¤º ===')\n\n// 1. Timer é˜¶æ®µ - setTimeout, setInterval\nsetTimeout(() => console.log('Timer: setTimeout'), 0)\nsetInterval(() => {\n  console.log('Timer: setInterval')\n  process.exit(0) // é¿å…æ— é™å¾ªç¯\n}, 100)\n\n// 2. Pending callbacks é˜¶æ®µ - I/O å›è°ƒ\nfs.readFile(__filename, () => {\n  console.log('I/O: fs.readFile å›è°ƒ')\n})\n\n// 3. Idle, prepare é˜¶æ®µ - å†…éƒ¨ä½¿ç”¨\n\n// 4. Poll é˜¶æ®µ - è·å–æ–°çš„ I/O äº‹ä»¶\n\n// 5. Check é˜¶æ®µ - setImmediate\nsetImmediate(() => console.log('Check: setImmediate'))\n\n// 6. Close callbacks é˜¶æ®µ\nconst server = require('http').createServer()\nserver.on('close', () => console.log('Close: server close'))\nserver.close()\n\n// å¾®ä»»åŠ¡é˜Ÿåˆ—\nprocess.nextTick(() => console.log('Microtask: process.nextTick'))\nPromise.resolve().then(() => console.log('Microtask: Promise.then'))"
  },
  "microtaskQueue": {
    "title": "å¾®ä»»åŠ¡é˜Ÿåˆ—",
    "language": "javascript",
    "code": "// å¾®ä»»åŠ¡ vs å®ä»»åŠ¡\nconsole.log('=== å¾®ä»»åŠ¡é˜Ÿåˆ—æ¼”ç¤º ===')\n\n// å®ä»»åŠ¡\nsetTimeout(() => console.log('å®ä»»åŠ¡: setTimeout 1'), 0)\nsetTimeout(() => console.log('å®ä»»åŠ¡: setTimeout 2'), 0)\n\n// å¾®ä»»åŠ¡\nprocess.nextTick(() => {\n  console.log('å¾®ä»»åŠ¡: process.nextTick 1')\n  // åœ¨å¾®ä»»åŠ¡ä¸­æ·»åŠ æ–°çš„å¾®ä»»åŠ¡\n  process.nextTick(() => console.log('å¾®ä»»åŠ¡: process.nextTick åµŒå¥—'))\n})\n\nPromise.resolve().then(() => {\n  console.log('å¾®ä»»åŠ¡: Promise.then 1')\n  return Promise.resolve()\n}).then(() => {\n  console.log('å¾®ä»»åŠ¡: Promise.then 2')\n})\n\nprocess.nextTick(() => console.log('å¾®ä»»åŠ¡: process.nextTick 2'))\n\nsetImmediate(() => console.log('å®ä»»åŠ¡: setImmediate'))\n\nconsole.log('åŒæ­¥ä»£ç ')\n\n// è¾“å‡ºé¡ºåº:\n// åŒæ­¥ä»£ç \n// å¾®ä»»åŠ¡: process.nextTick 1\n// å¾®ä»»åŠ¡: process.nextTick 2\n// å¾®ä»»åŠ¡: process.nextTick åµŒå¥—\n// å¾®ä»»åŠ¡: Promise.then 1\n// å¾®ä»»åŠ¡: Promise.then 2\n// å®ä»»åŠ¡: setTimeout 1\n// å®ä»»åŠ¡: setTimeout 2\n// å®ä»»åŠ¡: setImmediate"
  },
  "asyncAwait": {
    "title": "async/await ä¸äº‹ä»¶å¾ªç¯",
    "language": "javascript",
    "code": "// async/await åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„è¡Œä¸º\nasync function asyncDemo() {\n  console.log('async å‡½æ•°å¼€å§‹')\n  \n  // await ä¼šæš‚åœå‡½æ•°æ‰§è¡Œï¼Œå°†åç»­ä»£ç æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—\n  await Promise.resolve()\n  console.log('await åçš„ä»£ç ')\n  \n  await new Promise(resolve => {\n    setTimeout(() => {\n      console.log('Promise ä¸­çš„ setTimeout')\n      resolve()\n    }, 0)\n  })\n  \n  console.log('ç¬¬äºŒä¸ª await åçš„ä»£ç ')\n}\n\nconsole.log('å¼€å§‹')\n\nasyncDemo()\n\nsetTimeout(() => console.log('å¤–éƒ¨ setTimeout'), 0)\nprocess.nextTick(() => console.log('å¤–éƒ¨ nextTick'))\n\nconsole.log('ç»“æŸ')\n\n// å¤æ‚çš„ async/await ç¤ºä¾‹\nasync function complexAsync() {\n  console.log('complexAsync å¼€å§‹')\n  \n  const result1 = await fetch('https://api.example.com/data1')\n  console.log('ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œæˆ')\n  \n  const result2 = await fetch('https://api.example.com/data2')\n  console.log('ç¬¬äºŒä¸ªè¯·æ±‚å®Œæˆ')\n  \n  // å¹¶è¡Œæ‰§è¡Œ\n  const [data1, data2] = await Promise.all([\n    fetch('https://api.example.com/parallel1'),\n    fetch('https://api.example.com/parallel2')\n  ])\n  \n  console.log('å¹¶è¡Œè¯·æ±‚å®Œæˆ')\n  return { data1, data2 }\n}"
  },
  "performanceOptimization": {
    "title": "æ€§èƒ½ä¼˜åŒ–æŠ€å·§",
    "language": "javascript",
    "code": "// é¿å…é˜»å¡äº‹ä»¶å¾ªç¯\nconst crypto = require('crypto')\nconst { Worker, isMainThread, parentPort } = require('worker_threads')\n\n// âŒ é”™è¯¯ï¼šé˜»å¡äº‹ä»¶å¾ªç¯\nfunction blockingOperation() {\n  const start = Date.now()\n  // åŒæ­¥çš„CPUå¯†é›†å‹æ“ä½œ\n  crypto.pbkdf2Sync('secret', 'salt', 100000, 64, 'sha512')\n  console.log(`é˜»å¡æ“ä½œè€—æ—¶: ${Date.now() - start}ms`)\n}\n\n// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¼‚æ­¥æ“ä½œ\nfunction nonBlockingOperation() {\n  const start = Date.now()\n  crypto.pbkdf2('secret', 'salt', 100000, 64, 'sha512', (err, key) => {\n    if (err) throw err\n    console.log(`éé˜»å¡æ“ä½œè€—æ—¶: ${Date.now() - start}ms`)\n  })\n}\n\n// âœ… ä½¿ç”¨ Worker Threads å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡\nif (isMainThread) {\n  // ä¸»çº¿ç¨‹\n  const worker = new Worker(__filename)\n  worker.postMessage({ task: 'heavy-computation', data: [1, 2, 3, 4, 5] })\n  \n  worker.on('message', (result) => {\n    console.log('Worker ç»“æœ:', result)\n  })\n  \n  // ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡\n  setInterval(() => {\n    console.log('ä¸»çº¿ç¨‹ä»åœ¨è¿è¡Œ')\n  }, 1000)\n} else {\n  // Worker çº¿ç¨‹\n  parentPort.on('message', ({ task, data }) => {\n    if (task === 'heavy-computation') {\n      // æ‰§è¡ŒCPUå¯†é›†å‹è®¡ç®—\n      const result = data.reduce((sum, num) => {\n        // æ¨¡æ‹Ÿå¤æ‚è®¡ç®—\n        for (let i = 0; i < 1000000; i++) {\n          sum += num * Math.random()\n        }\n        return sum\n      }, 0)\n      \n      parentPort.postMessage(result)\n    }\n  })\n}\n\n// ä½¿ç”¨ setImmediate åˆ†å‰²é•¿ä»»åŠ¡\nfunction processLargeArray(array, callback) {\n  if (array.length === 0) {\n    return callback()\n  }\n  \n  // å¤„ç†ä¸€å°éƒ¨åˆ†æ•°æ®\n  const batch = array.splice(0, 100)\n  batch.forEach(item => {\n    // å¤„ç†å•ä¸ªé¡¹ç›®\n    console.log(`å¤„ç†é¡¹ç›®: ${item}`)\n  })\n  \n  // ä½¿ç”¨ setImmediate è®©å‡ºæ§åˆ¶æƒ\n  setImmediate(() => processLargeArray(array, callback))\n}"
  },
  "timerComparison": {
    "title": "å®šæ—¶å™¨å¯¹æ¯”",
    "language": "javascript",
    "code": "// setTimeout vs setImmediate vs process.nextTick\nconsole.log('=== å®šæ—¶å™¨æ‰§è¡Œé¡ºåºå¯¹æ¯” ===')\n\n// ç«‹å³æ‰§è¡Œ\nconsole.log('1. åŒæ­¥ä»£ç ')\n\n// å¾®ä»»åŠ¡é˜Ÿåˆ— - æœ€é«˜ä¼˜å…ˆçº§\nprocess.nextTick(() => console.log('2. process.nextTick'))\nPromise.resolve().then(() => console.log('3. Promise.then'))\n\n// å®ä»»åŠ¡é˜Ÿåˆ—\nsetTimeout(() => console.log('4. setTimeout 0'), 0)\nsetImmediate(() => console.log('5. setImmediate'))\n\n// I/O æ“ä½œ\nconst fs = require('fs')\nfs.readFile(__filename, () => {\n  console.log('6. fs.readFile')\n  \n  // åœ¨ I/O å›è°ƒä¸­çš„æ‰§è¡Œé¡ºåº\n  setTimeout(() => console.log('7. setTimeout in I/O'), 0)\n  setImmediate(() => console.log('8. setImmediate in I/O'))\n  process.nextTick(() => console.log('9. nextTick in I/O'))\n})\n\nconsole.log('10. åŒæ­¥ä»£ç ç»“æŸ')"
  },
  "eventLoopMonitoring": {
    "title": "äº‹ä»¶å¾ªç¯ç›‘æ§",
    "language": "javascript",
    "code": "// ç›‘æ§äº‹ä»¶å¾ªç¯å»¶è¿Ÿ\nconst { performance } = require('perf_hooks')\n\nclass EventLoopMonitor {\n  constructor() {\n    this.delays = []\n    this.isMonitoring = false\n  }\n  \n  start() {\n    if (this.isMonitoring) return\n    \n    this.isMonitoring = true\n    this.monitor()\n    console.log('ğŸ” å¼€å§‹ç›‘æ§äº‹ä»¶å¾ªç¯å»¶è¿Ÿ')\n  }\n  \n  stop() {\n    this.isMonitoring = false\n    console.log('â¹ï¸  åœæ­¢ç›‘æ§äº‹ä»¶å¾ªç¯å»¶è¿Ÿ')\n  }\n  \n  monitor() {\n    if (!this.isMonitoring) return\n    \n    const start = performance.now()\n    \n    setImmediate(() => {\n      const delay = performance.now() - start\n      this.delays.push(delay)\n      \n      // ä¿æŒæœ€è¿‘100ä¸ªæ ·æœ¬\n      if (this.delays.length > 100) {\n        this.delays.shift()\n      }\n      \n      // å¦‚æœå»¶è¿Ÿè¿‡é«˜ï¼Œå‘å‡ºè­¦å‘Š\n      if (delay > 10) {\n        console.warn(`âš ï¸  äº‹ä»¶å¾ªç¯å»¶è¿Ÿè¿‡é«˜: ${delay.toFixed(2)}ms`)\n      }\n      \n      // ç»§ç»­ç›‘æ§\n      this.monitor()\n    })\n  }\n  \n  getStats() {\n    if (this.delays.length === 0) {\n      return { avg: 0, max: 0, min: 0 }\n    }\n    \n    const avg = this.delays.reduce((a, b) => a + b, 0) / this.delays.length\n    const max = Math.max(...this.delays)\n    const min = Math.min(...this.delays)\n    \n    return {\n      avg: avg.toFixed(2),\n      max: max.toFixed(2),\n      min: min.toFixed(2),\n      samples: this.delays.length\n    }\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst monitor = new EventLoopMonitor()\nmonitor.start()\n\n// æ¨¡æ‹Ÿä¸€äº›å·¥ä½œè´Ÿè½½\nsetInterval(() => {\n  const stats = monitor.getStats()\n  console.log('ğŸ“Š äº‹ä»¶å¾ªç¯ç»Ÿè®¡:', stats)\n}, 5000)\n\n// æ¨¡æ‹Ÿé˜»å¡æ“ä½œ\nsetTimeout(() => {\n  console.log('ğŸ”¥ æ‰§è¡Œé˜»å¡æ“ä½œ...')\n  const start = Date.now()\n  while (Date.now() - start < 100) {\n    // é˜»å¡100ms\n  }\n  console.log('âœ… é˜»å¡æ“ä½œå®Œæˆ')\n}, 10000)"
  }
}
